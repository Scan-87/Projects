SMB Share

# apt install samba smbclient
# cd /etc/samba
# cp smb.conf smb.conf.back

# useradd <smbuser>
# passwd <smbuser>		пароль пользователя
# smbpasswd -a <smbuser>	пароль для подключения по SMB

# mkdir /FileShare/<smbuser>	публичная шара
# mkdir /FileShare/<smbguest> 	приватная шара

# chmod 777 /FileShare/smbguest
# chown root:smbuser /FileShare/smbguest
# chmod 770 /FileShare/smbuser
# chown root:smbuser /FileShare/smbuser

# vim smb.conf 
	[global]
		server role = standalone server
	        map to guest = Bad User
        	usershare allow guests = no
        	hosts allow = 192.168.0.0/22, 192.168.255.0/24
        	hosts deny = 0.0.0.0/0
		
	[Public]
		comment = public share
		path = /FileShare/smbguest
		guest ok = yes
		browsable = yes
		writable = yes
		read only = no
		force user = smbuser
		force group = smbuser

	[Private]
		comment = private share
		path = /FileShare/smbuser
		guest ok = no
		browsable = yes		хотим что бы шара была видна?
		read only = no
		force user = smbuser
		force group = smbuser

# service smbd restart





Rsync Backups

Server

# apt-get install rsync
# vim /etc/default/rsync
	RSYNC_ENABLE=true
	
# touch /etc/rsyncd.conf
# vim /etc/rsyncd.conf

max connections = 10
exclude = lost+found/
dont compress   = *.gz *.tgz *.zip *.z *.Z *.rpm *.deb *.bz2 *.rar *.7z *.mp3 *.jpg 

[laptop]
    uid = smblaptop
    gid = smblaptop
    path = /FileShare/SMB_backups/laptop
    comment = laptop backup
    read only = no
    list = yes
    auth users = smblaptop
    secrets file = /etc/rsyncd.scrt
    hosts allow = 192.168.1.11 
    hosts deny = *
 

[vdsina]
    uid = smbvdsina
    gid = smbvdsina
    path = /FileShare/SMB_backups/vdsina
    comment = vdsina backup
    read only = no
    list = yes
    auth users = smbvdsina
    secrets file = /etc/rsyncd.scrt
    hosts allow = 192.168.255.1 
    hosts deny = *


# vim /etc/rsyncd.scrt
smblaptop:password
smbvdsina:password

# chmod 600 /etc/rsyncd.scrt
# service rsync restart



Client

# vim ~/.rsync.scrt
<password>
# chmod 600 ~/.rsync.scrt

# sudo rsync -aAXvv --password-file=~/.rsync.scrt / --exclude={"/dev/*","/proc/*","/sys/*","/tmp/*","/run/*","/mnt/*","/media/*","/lost+found"} smblaptop@192.168.2.10::laptop/ubuntu 	





Nextcloud Compose
Предварительно создать сеть nextcloud. Указанные адреса должны в нее входить
Создать директории по пути из volumes, должны принадлежать www-data

version: '3' 

services:
  nextclouddb:
    image: mariadb:latest
    container_name: nextcloud-mariadb
    command: --transaction-isolation=READ-COMMITTED --binlog-format=ROW --innodb-file-per-table=1 --skip-innodb-read-only-compressed
    volumes:
      - /FileShare/Nextcloud/MySql:/var/lib/mysql
      - /etc/localtime:/etc/localtime:ro
    networks:
      default:
        ipv4_address: 172.19.0.11
    environment:
      - MYSQL_ROOT_PASSWORD=<pass>
      - MYSQL_PASSWORD=<pass>
      - MYSQL_DATABASE=nextcloud
      - MYSQL_USER=<user>
    restart: unless-stopped
  
  nextcloudapp:
    image: nextcloud:latest
    container_name: nextcloud-app
    networks:
      default:
        ipv4_address: 172.19.0.10
    volumes:
      - /home/Nextcloud-config/html:/var/www/html
      - /home/Nextcloud-config/custom_apps:/var/www/html/custom_apps
      - /FileShare/Nextcloud/data:/var/www/html/data
      - /etc/localtime:/etc/localtime:ro
    restart: unless-stopped
    ports:
      - 8080:80

networks:
  default:
    external:
      name: nextcloud_network


Доступ из-за Proxy
# vim html/config/config.php

'trusted_domains' =>
  array (
    0 => '192.168.2.10:8080',
    1 => '172.168.255.20',
    2 => '172.17.0.1:80',
  ),
закоментировать:
  #  'overwrite.cli.url' => 'http://192.168.2.10:8080',
добавить:
  'overwritehost' => 'cloud.scan-87.online:443',
  'overwriteprotocol' => 'https',




SMB Share

# apt install samba smbclient
# cd /etc/samba
# cp smb.conf smb.conf.back

# useradd <smbuser>
# passwd <smbuser>		пароль пользователя
# smbpasswd -a <smbuser>	пароль для подключения по SMB

# mkdir /FileShare/<smbuser>	публичная шара
# mkdir /FileShare/<smbguest> 	приватная шара

# chmod 777 /FileShare/smbguest
# chown root:smbuser /FileShare/smbguest
# chmod 770 /FileShare/smbuser
# chown root:smbuser /FileShare/smbuser

# vim smb.conf 
	[global]
		server role = standalone server
	        map to guest = Bad User
        	usershare allow guests = no
        	hosts allow = 192.168.0.0/22, 192.168.255.0/24
        	hosts deny = 0.0.0.0/0
		
	[Public]
		comment = public share
		path = /FileShare/smbguest
		guest ok = yes
		browsable = yes
		writable = yes
		read only = no
		force user = smbuser
		force group = smbuser

	[Private]
		comment = private share
		path = /FileShare/smbuser
		guest ok = no
		browsable = yes		хотим что бы шара была видна?
		read only = no
		force user = smbuser
		force group = smbuser

# service smbd restart





Rsync Backups

Server

# apt-get install rsync
# vim /etc/default/rsync
	RSYNC_ENABLE=true
	
# touch /etc/rsyncd.conf
# vim /etc/rsyncd.conf

max connections = 10
exclude = lost+found/
dont compress   = *.gz *.tgz *.zip *.z *.Z *.rpm *.deb *.bz2 *.rar *.7z *.mp3 *.jpg 

[laptop]
    uid = smblaptop
    gid = smblaptop
    path = /FileShare/SMB_backups/laptop
    comment = laptop backup
    read only = no
    list = yes
    auth users = smblaptop
    secrets file = /etc/rsyncd.scrt
    hosts allow = 192.168.1.11 
    hosts deny = *
 

[vdsina]
    uid = smbvdsina
    gid = smbvdsina
    path = /FileShare/SMB_backups/vdsina
    comment = vdsina backup
    read only = no
    list = yes
    auth users = smbvdsina
    secrets file = /etc/rsyncd.scrt
    hosts allow = 192.168.255.1 
    hosts deny = *


# vim /etc/rsyncd.scrt
smblaptop:password
smbvdsina:password

# chmod 600 /etc/rsyncd.scrt
# service rsync restart



Client

# vim ~/.rsync.scrt
<password>
# chmod 600 ~/.rsync.scrt

# sudo rsync -aAXvv --password-file=~/.rsync.scrt / --exclude={"/dev/*","/proc/*","/sys/*","/tmp/*","/run/*","/mnt/*","/media/*","/lost+found"} smblaptop@192.168.2.10::laptop/ubuntu 	




